### Elasticsearch

#### 基础
1. 不适合作为主存储：没有事务，可能出现数据丢失和污染、近实时、吃内存、mapping不能修改
1. 分片-主分片，可读可写，数量确定后就不能修改，除非reindex
1. 分片-副本分片，只可读，数量可以后期修改
1. 节点类型：
  1. Master Eligible Node，候选主节点
  1. Data Node，数据节点
  1. Coordinating Node，路由节点，负责路由转发和查询汇总
1. 索引的index，相当于数据库的table
1. 索引的mapping，相当于表的schema，定义字段的类型
1. 索引的setting，定义不同的数据分布

#### _cluster 命令
- 节点的状态：GET /_cluster/health?level=nodes
- 索引的状态：GET /_cluster/health?level=indices

#### _cat 命令
1. /_cat/health 查看集群整体状态
1. /_cat/nodes?v&s=ip:desc 查看节点(负载信息)
1. /_cat/nodes?v&h=name,diskUsed,diskTotal 查看磁盘使用
1. /_cat/allocation 查看磁盘使用
1. /_cat/shards 查看node下的shard分布
1. /_cat/indices 查所有索引
1. /_cat/segments/* 查看index内存占用
1. /_cat/plugins 查看扩展
1. /_cat/count 查看文档总数

#### 监控
1. 集群级别：GET /_cluster/health
1. 节点级别：GET /_nodes/stats，如果nodes.节点.fielddata_breaker.tripped值很大或者一直增，说明内存不够经常OOM
1. 索引级别：GET /{index_name}/_stats，index_name 可以改成 _all

#### 其他
1. 查看模板：GET /_template
1. 查看设置项：GET /_all/_settings
1. 清理缓存：POST /_cache/clear
1. 查看当前的task：GET /_tasks
1. 查索引的type和mapping：GET /_mapping
1. 查mapping的字段类型：GET ngx-access-mobotoolpush-2018.04.12/_mapping/doc






